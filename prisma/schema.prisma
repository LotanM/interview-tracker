generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ApplicationStatus {
  DRAFT
  APPLIED
  IN_PROCESS
  ON_HOLD
  OFFER
  REJECTED
  WITHDRAWN
}

enum ApplicationDesireLevel {
  LOW
  MEDIUM
  HIGH
}

enum InterviewStageType {
  HR
  TECHNICAL
  ARCHITECTURE
  ASSIGNMENT
  MANAGER
  CTO
  OTHER
}

enum InterviewStageLocation {
  IN_PERSON
  ZOOM
  GOOGLE_MEET
  PHONE_CALL
  OTHER
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  createdAt DateTime  @default(now())
  companies Company[]
}

model Company {
  id           String        @id @default(uuid())
  userId       String
  name         String
  website      String?
  user         User          @relation(fields: [userId], references: [id])
  applications Application[]
  createdAt    DateTime      @default(now())

  @@unique([userId, name])
}

model Application {
  id          String                  @id @default(uuid())
  role        String
  sourceUrl   String?
  status      ApplicationStatus       @default(DRAFT)
  pitch       String?
  desireLevel ApplicationDesireLevel? // how much I want this role
  companyId   String
  company     Company                 @relation(fields: [companyId], references: [id])
  stages      InterviewStage[]
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
}

model InterviewStage {
  id                String                  @id @default(uuid())
  order             Int
  type              InterviewStageType
  location          InterviewStageLocation?
  isCompleted       Boolean                 @default(false)
  interviewerName   String?
  preparationNotes  String?
  reflectionNotes   String?
  questionsAsked    String?
  whyItDidntGoWell  String?
  betterAnswerToday String?
  outcome           String?
  applicationId     String
  application       Application             @relation(fields: [applicationId], references: [id])
  scheduledAt       DateTime?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt

  @@unique([applicationId, order])
}
